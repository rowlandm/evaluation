<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Droppable - Default functionality</title>
  <style>
  .draggable { width: 350px;  padding: 0.1em; font-size: 12px;  background-color: grey;}
  .droppable { width: 450px; height: 150px; padding: 0.5em; float: left; margin: 10px; background-color:orange;}
  </style>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>



    $(document).ready(function(){


        $('#final_report').click(function(){
            list_of_draggables = $('.draggable');
            json_export_array = new Array();
            for (var counter = 0, len = list_of_draggables.length; counter < len; counter++) {
                draggable =$(list_of_draggables[counter]) ;
                droppable_div = draggable.parents('.droppable');
                name = draggable.html();
                raw_id = draggable.attr('id');
                id = raw_id.replace('draggable','');
                urgent_important = $(droppable_div).attr('data-urgent-important');
                if (urgent_important != undefined){
                    temp = urgent_important.split('::');
                    urgent = temp[0];
                    important = temp[1];
                    
                    task = new Object();
                    task.id = id;
                    task.name = name;
                    task.urgency = urgent;
                    task.importance = important;

                    json_export_array.push(task);
                } 
            }

            json_export = JSON.stringify(json_export_array);


            alert(json_export);
        });


        urgent_levels  = 3;
        important_levels = 2;
        for (var counter_urgent = urgent_levels, len = 0; counter_urgent > len; counter_urgent--) {
            for (var counter_importance = 0, len_important = important_levels; counter_importance < len_important; counter_importance++) {
                name= 'Drop here - Urgent:' + (counter_urgent) + ' Importance:' + (counter_importance+1);
                new_div = '<div data-urgent-important="'+counter_urgent+'::'+(counter_importance+1)+'" id="droppable'+name+'" class="droppable ui-widget-header"> <p>Drop here - '+name+'</p><ul></ul> </div>';
                
                $(document.body).append(new_div);
            }
            $(document.body).append('<div style="clear:both"></div>');
        }


        all_tasks_json = '[{"name":"Create YuGene for Jason","id":12131,"urgency":3,"importance":2},{"name":"Setup scPipe on Raijin","id":12134,"urgency":2,"importance":2},{"name":"Troubleshoot GEG","id":12135,"urgency":1,"importance":1}]' 

        all_tasks = JSON.parse(all_tasks_json)

        for (var counter = 0, len = all_tasks.length; counter < len; counter++) {
            name= all_tasks[counter].name;
            id= all_tasks[counter].id;
            importance = all_tasks[counter].importance;
            urgency = all_tasks[counter].urgency;

            new_li = '<li id="draggable'+id+'" class="draggable">'+name+'</li>';
            $('[data-urgent-important="'+urgency+'::'+importance+'"]').find("ul").append(new_li);
            
        }


        $( ".draggable" ).draggable();
        $( ".droppable" ).droppable({
          drop: function( event, ui ) {

            id = ui.draggable.attr('id');
            name = ui.draggable.html() ;

            new_li = '<li id="'+id+'" class="draggable">'+name+'</li>';

            $( this )
              .find( "ul" )
                .append(new_li);
            $( ".draggable" ).draggable();
            ui.draggable.remove();
          }
        });
  } );
  </script>
</head>
<body>
<!-- from https://jqueryui.com/droppable/#default -->
 

<button id="final_report">Final Report</button>
 
</body>
</html>
